<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Docker and Minikube behind HTTP Proxy | CODE FARM</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Docker and Minikube behind HTTP Proxy" />
<meta property="og:locale" content="en" />
<meta name="description" content="1. Setup HTTP Proxy Environment Variables 2. Custom Docker Daemon Options with HTTP Proxy 3. Start minikube behind a HTTP Proxy References 1. Setup HTTP Proxy Environment Variables Linux and Unix-like systems has environment variable called http_proxy, https_proxy and no_proxy. It allows you to connect text based session and/or applications via the proxy server. All you need is proxy server IP address (URL) and port values. The variable is almost used by all utilities such as elinks, lynx, wget, curl, git and others commands. Type the following command to set proxy server environment variables: $ export http_proxy=http://[USERNAME:PASSWORD@]server-ip:port/ $ export https_proxy=http://[USERNAME:PASSWORD@]server-ip:port/ $ export no_proxy=localhost,127.0.0.1,::1,codefarm.me To setup the proxy environment variable as a global variable for all users, append the above settings into /etc/profile file or /etc/profile.d/http-proxy.sh. for example: $ cat /etc/profile.d/http_proxy.sh export {HTTP,HTTPS}_PROXY=http://10.38.32.9:10808/ export {http,https}_proxy=http://10.38.32.9:10808/ export {NO_PROXY,no_proxy}=localhost,127.0.0.1,::1,192.168.99.100 $ env | grep -i proxy HTTP_PROXY=http://10.38.32.9:10808/ https_proxy=http://10.38.32.9:10808/ http_proxy=http://10.38.32.189:10808/ no_proxy=localhost,127.0.0.1,::1,192.168.99.100 NO_PROXY=localhost,127.0.0.1,::1,192.168.99.100 HTTPS_PROXY=http://10.38.32.9:10808/ 2. Custom Docker Daemon Options with HTTP Proxy The Docker daemon uses the HTTP_PROXY, HTTPS_PROXY, and NO_PROXY environmental variables in its start-up environment to configure HTTP or HTTPS proxy behavior. You cannot configure these environment variables using the daemon.json file. This example overrides the default docker.service file. If you are behind an HTTP or HTTPS proxy server, for example in corporate settings, you need to add this configuration in the Docker systemd service file. Create a systemd drop-in directory for the docker service: $ sudo mkdir -p /etc/systemd/system/docker.service.d Create a file called /etc/systemd/system/docker.service.d/http-proxy.conf that adds the HTTP_PROXY environment variable: [Service] Environment=&quot;HTTP_PROXY=http://proxy.example.com:80/&quot; Or, if you are behind an HTTPS proxy server, create a file called /etc/systemd/system/docker.service.d/https-proxy.conf that adds the HTTPS_PROXY environment variable: [Service] Environment=&quot;HTTPS_PROXY=https://proxy.example.com:443/&quot; If you have internal Docker registries that you need to contact without proxying you can specify them via the NO_PROXY environment variable: [Service] Environment=&quot;HTTP_PROXY=http://proxy.example.com:80/&quot; &quot;NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com&quot; Or, if you are behind an HTTPS proxy server: [Service] Environment=&quot;HTTPS_PROXY=https://proxy.example.com:443/&quot; &quot;NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com&quot; Flush changes: $ sudo systemctl daemon-reload Restart Docker: $ sudo systemctl restart docker Verify that the configuration has been loaded: $ systemctl show --property=Environment docker Environment=HTTP_PROXY=http://proxy.example.com:80/ Or, if you are behind an HTTPS proxy server: $ systemctl show --property=Environment docker Environment=HTTPS_PROXY=https://proxy.example.com:443/ 3. Start minikube behind a HTTP Proxy Print the version of minikube. $ minikube version minikube version: v0.25.2 The latest minikube version is 0.28.2 at this time, but it doesn’t work well cause it hangs up at Starting cluster components…. Use --docker-env flag to pass environment variables to the Docker daemon. minikube start \ --docker-env HTTP_PROXY=http://10.38.32.9:10808/ \ --docker-env HTTPS_PROXY=http://10.38.32.9:10808/ \ --docker-env NO_PROXY=index.docker.io,\ registry.hub.docker.com,\ registry-1.docker.io,\ registry.docker-cn.com,\ registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,\ 192.168.99.100\ --registry-mirror https://registry.docker-cn.com Not required: Pass the --registry-mirror option when starting dockerd to pull-through China mirror cache. Use kubectl version to print the client and server version information. $ kubectl version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.0&quot;, GitCommit:&quot;91e7b4fd31fcd3d5f436da26c980becec37ceefe&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-06-27T20:17:28Z&quot;, GoVersion:&quot;go1.10.2&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} Server Version: version.Info{Major:&quot;&quot;, Minor:&quot;&quot;, GitVersion:&quot;v1.9.4&quot;, GitCommit:&quot;bee2d1505c4fe820744d26d41ecd3fdd4a3d6546&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-03-21T21:48:36Z&quot;, GoVersion:&quot;go1.9.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} After starting the minikube, the --docker-env and --registry-mirror options were wrote into config.json file at $HOME/.minikube/machines/minikube/config.json. And when starting minikube with minikube start, it will reload the config from the file config.json again. 33 &quot;HostOptions&quot;: { 37 &quot;EngineOptions&quot;: { . 41 &quot;Env&quot;: [ 42 &quot;HTTP_PROXY=http://10.38.32.9:10808/&quot;, 43 &quot;HTTPS_PROXY=http://10.38.32.9:10808/&quot;, 44 &quot;NO_PROXY=index.docker.io,registry.hub.docker.com,registry-1.docker.io,registry.docker-cn.com,registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,192.168.99.100&quot; 45 ], . 55 &quot;RegistryMirror&quot;: [ 56 &quot;https://registry.docker-cn.com&quot; 57 ], The minikube start --docker-env doesn’t work on my Windows 10 laptop. But you can edit the config.json directly, then start the minikube and execute the following command to reload docker daemon. $ uname.exe -a MINGW64_NT-10.0 minikube 2.10.0(0.325/5/3) 2018-06-13 23:34 x86_64 Msys $ minikube.exe start There is a newer version of minikube available (v0.28.2). Download it here: https://github.com/kubernetes/minikube/releases/tag/v0.28.2 To disable this notification, run the following: minikube config set WantUpdateNotification false Starting local Kubernetes v1.9.4 cluster... Starting VM... Getting VM IP address... Moving files into cluster... Setting up certs... Connecting to cluster... Setting up kubeconfig... Starting cluster components... Kubectl is now configured to use the cluster. Loading cached images from config file. Unable to load cached images from config file. $ kubectl.exe version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;7&quot;, GitVersion:&quot;v1.7.4&quot;, GitCommit:&quot;793658f2d7ca7f064d2bdf606519f9fe1229c381&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2017-08-17T08:48:23Z&quot;, GoVersion:&quot;go1.8.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;windows/amd64&quot;} Server Version: version.Info{Major:&quot;&quot;, Minor:&quot;&quot;, GitVersion:&quot;v1.9.4&quot;, GitCommit:&quot;bee2d1505c4fe820744d26d41ecd3fdd4a3d6546&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-03-21T21:48:36Z&quot;, GoVersion:&quot;go1.9.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} $ minikube.exe ssh _ _ _ _ ( ) ( ) ___ ___ (_) ___ (_)| |/&#39;) _ _ | |_ __ /&#39; _ ` _ `\| |/&#39; _ `\| || , &lt; ( ) ( )| &#39;_`\ /&#39;__`\ | ( ) ( ) || || ( ) || || |\`\ | (_) || |_) )( ___/ (_) (_) (_)(_)(_) (_)(_)(_) (_)`\___/&#39;(_,__/&#39;`\____) $ sudo systemctl daemon-reload $ sudo systemctl restart docker Hello Minikube $ kubectl run nginx --image=nginx --image-pull-policy=IfNotPresent --replicas=2 deployment.apps/nginx created $ kubectl get pods NAME READY STATUS RESTARTS AGE nginx-6d78847c9c-298qt 1/1 Running 0 &lt;invalid&gt; nginx-6d78847c9c-v88mt 1/1 Running 0 &lt;invalid&gt; $ kubectl expose deployments/nginx --type=NodePort --port 80 service/nginx exposed $ export NODE_PORT=$(kubectl get service nginx -o go-template=&#39;{{(index .spec.ports 0).nodePort}}&#39;) $ echo $NODE_PORT 32659 $ curl -i -XOPTION $(minikube ip):$NODE_PORT HTTP/1.1 405 Not Allowed Server: nginx/1.15.2 Date: Fri, 10 Aug 2018 09:36:08 GMT Content-Type: text/html Content-Length: 173 Connection: keep-alive &lt;html&gt; &lt;head&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt; &lt;body bgcolor=&quot;white&quot;&gt; &lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt; &lt;hr&gt;&lt;center&gt;nginx/1.15.2&lt;/center&gt; &lt;/body&gt; &lt;/html&gt; References Proxy server - Wikipedia, https://en.wikipedia.org/wiki/Proxy_server How To Use Proxy Server To Access Internet at Shell Prompt With http_proxy Variable - nixCraft, https://www.cyberciti.biz/faq/linux-unix-set-proxy-environment-variable/ Control Docker with systemd | Docker Documentation, https://docs.docker.com/config/daemon/systemd/#httphttps-proxy Using Minikube with an HTTP Proxy, https://kubernetes.io/docs/setup/minikube/#using-minikube-with-an-http-proxy bash - Set a network range in the no_proxy environment variable - Unix &amp; Linux Stack Exchange, https://unix.stackexchange.com/questions/23452/set-a-network-range-in-the-no-proxy-environment-variable" />
<meta property="og:description" content="1. Setup HTTP Proxy Environment Variables 2. Custom Docker Daemon Options with HTTP Proxy 3. Start minikube behind a HTTP Proxy References 1. Setup HTTP Proxy Environment Variables Linux and Unix-like systems has environment variable called http_proxy, https_proxy and no_proxy. It allows you to connect text based session and/or applications via the proxy server. All you need is proxy server IP address (URL) and port values. The variable is almost used by all utilities such as elinks, lynx, wget, curl, git and others commands. Type the following command to set proxy server environment variables: $ export http_proxy=http://[USERNAME:PASSWORD@]server-ip:port/ $ export https_proxy=http://[USERNAME:PASSWORD@]server-ip:port/ $ export no_proxy=localhost,127.0.0.1,::1,codefarm.me To setup the proxy environment variable as a global variable for all users, append the above settings into /etc/profile file or /etc/profile.d/http-proxy.sh. for example: $ cat /etc/profile.d/http_proxy.sh export {HTTP,HTTPS}_PROXY=http://10.38.32.9:10808/ export {http,https}_proxy=http://10.38.32.9:10808/ export {NO_PROXY,no_proxy}=localhost,127.0.0.1,::1,192.168.99.100 $ env | grep -i proxy HTTP_PROXY=http://10.38.32.9:10808/ https_proxy=http://10.38.32.9:10808/ http_proxy=http://10.38.32.189:10808/ no_proxy=localhost,127.0.0.1,::1,192.168.99.100 NO_PROXY=localhost,127.0.0.1,::1,192.168.99.100 HTTPS_PROXY=http://10.38.32.9:10808/ 2. Custom Docker Daemon Options with HTTP Proxy The Docker daemon uses the HTTP_PROXY, HTTPS_PROXY, and NO_PROXY environmental variables in its start-up environment to configure HTTP or HTTPS proxy behavior. You cannot configure these environment variables using the daemon.json file. This example overrides the default docker.service file. If you are behind an HTTP or HTTPS proxy server, for example in corporate settings, you need to add this configuration in the Docker systemd service file. Create a systemd drop-in directory for the docker service: $ sudo mkdir -p /etc/systemd/system/docker.service.d Create a file called /etc/systemd/system/docker.service.d/http-proxy.conf that adds the HTTP_PROXY environment variable: [Service] Environment=&quot;HTTP_PROXY=http://proxy.example.com:80/&quot; Or, if you are behind an HTTPS proxy server, create a file called /etc/systemd/system/docker.service.d/https-proxy.conf that adds the HTTPS_PROXY environment variable: [Service] Environment=&quot;HTTPS_PROXY=https://proxy.example.com:443/&quot; If you have internal Docker registries that you need to contact without proxying you can specify them via the NO_PROXY environment variable: [Service] Environment=&quot;HTTP_PROXY=http://proxy.example.com:80/&quot; &quot;NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com&quot; Or, if you are behind an HTTPS proxy server: [Service] Environment=&quot;HTTPS_PROXY=https://proxy.example.com:443/&quot; &quot;NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com&quot; Flush changes: $ sudo systemctl daemon-reload Restart Docker: $ sudo systemctl restart docker Verify that the configuration has been loaded: $ systemctl show --property=Environment docker Environment=HTTP_PROXY=http://proxy.example.com:80/ Or, if you are behind an HTTPS proxy server: $ systemctl show --property=Environment docker Environment=HTTPS_PROXY=https://proxy.example.com:443/ 3. Start minikube behind a HTTP Proxy Print the version of minikube. $ minikube version minikube version: v0.25.2 The latest minikube version is 0.28.2 at this time, but it doesn’t work well cause it hangs up at Starting cluster components…. Use --docker-env flag to pass environment variables to the Docker daemon. minikube start \ --docker-env HTTP_PROXY=http://10.38.32.9:10808/ \ --docker-env HTTPS_PROXY=http://10.38.32.9:10808/ \ --docker-env NO_PROXY=index.docker.io,\ registry.hub.docker.com,\ registry-1.docker.io,\ registry.docker-cn.com,\ registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,\ 192.168.99.100\ --registry-mirror https://registry.docker-cn.com Not required: Pass the --registry-mirror option when starting dockerd to pull-through China mirror cache. Use kubectl version to print the client and server version information. $ kubectl version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.0&quot;, GitCommit:&quot;91e7b4fd31fcd3d5f436da26c980becec37ceefe&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-06-27T20:17:28Z&quot;, GoVersion:&quot;go1.10.2&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} Server Version: version.Info{Major:&quot;&quot;, Minor:&quot;&quot;, GitVersion:&quot;v1.9.4&quot;, GitCommit:&quot;bee2d1505c4fe820744d26d41ecd3fdd4a3d6546&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-03-21T21:48:36Z&quot;, GoVersion:&quot;go1.9.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} After starting the minikube, the --docker-env and --registry-mirror options were wrote into config.json file at $HOME/.minikube/machines/minikube/config.json. And when starting minikube with minikube start, it will reload the config from the file config.json again. 33 &quot;HostOptions&quot;: { 37 &quot;EngineOptions&quot;: { . 41 &quot;Env&quot;: [ 42 &quot;HTTP_PROXY=http://10.38.32.9:10808/&quot;, 43 &quot;HTTPS_PROXY=http://10.38.32.9:10808/&quot;, 44 &quot;NO_PROXY=index.docker.io,registry.hub.docker.com,registry-1.docker.io,registry.docker-cn.com,registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,192.168.99.100&quot; 45 ], . 55 &quot;RegistryMirror&quot;: [ 56 &quot;https://registry.docker-cn.com&quot; 57 ], The minikube start --docker-env doesn’t work on my Windows 10 laptop. But you can edit the config.json directly, then start the minikube and execute the following command to reload docker daemon. $ uname.exe -a MINGW64_NT-10.0 minikube 2.10.0(0.325/5/3) 2018-06-13 23:34 x86_64 Msys $ minikube.exe start There is a newer version of minikube available (v0.28.2). Download it here: https://github.com/kubernetes/minikube/releases/tag/v0.28.2 To disable this notification, run the following: minikube config set WantUpdateNotification false Starting local Kubernetes v1.9.4 cluster... Starting VM... Getting VM IP address... Moving files into cluster... Setting up certs... Connecting to cluster... Setting up kubeconfig... Starting cluster components... Kubectl is now configured to use the cluster. Loading cached images from config file. Unable to load cached images from config file. $ kubectl.exe version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;7&quot;, GitVersion:&quot;v1.7.4&quot;, GitCommit:&quot;793658f2d7ca7f064d2bdf606519f9fe1229c381&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2017-08-17T08:48:23Z&quot;, GoVersion:&quot;go1.8.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;windows/amd64&quot;} Server Version: version.Info{Major:&quot;&quot;, Minor:&quot;&quot;, GitVersion:&quot;v1.9.4&quot;, GitCommit:&quot;bee2d1505c4fe820744d26d41ecd3fdd4a3d6546&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-03-21T21:48:36Z&quot;, GoVersion:&quot;go1.9.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} $ minikube.exe ssh _ _ _ _ ( ) ( ) ___ ___ (_) ___ (_)| |/&#39;) _ _ | |_ __ /&#39; _ ` _ `\| |/&#39; _ `\| || , &lt; ( ) ( )| &#39;_`\ /&#39;__`\ | ( ) ( ) || || ( ) || || |\`\ | (_) || |_) )( ___/ (_) (_) (_)(_)(_) (_)(_)(_) (_)`\___/&#39;(_,__/&#39;`\____) $ sudo systemctl daemon-reload $ sudo systemctl restart docker Hello Minikube $ kubectl run nginx --image=nginx --image-pull-policy=IfNotPresent --replicas=2 deployment.apps/nginx created $ kubectl get pods NAME READY STATUS RESTARTS AGE nginx-6d78847c9c-298qt 1/1 Running 0 &lt;invalid&gt; nginx-6d78847c9c-v88mt 1/1 Running 0 &lt;invalid&gt; $ kubectl expose deployments/nginx --type=NodePort --port 80 service/nginx exposed $ export NODE_PORT=$(kubectl get service nginx -o go-template=&#39;{{(index .spec.ports 0).nodePort}}&#39;) $ echo $NODE_PORT 32659 $ curl -i -XOPTION $(minikube ip):$NODE_PORT HTTP/1.1 405 Not Allowed Server: nginx/1.15.2 Date: Fri, 10 Aug 2018 09:36:08 GMT Content-Type: text/html Content-Length: 173 Connection: keep-alive &lt;html&gt; &lt;head&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt; &lt;body bgcolor=&quot;white&quot;&gt; &lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt; &lt;hr&gt;&lt;center&gt;nginx/1.15.2&lt;/center&gt; &lt;/body&gt; &lt;/html&gt; References Proxy server - Wikipedia, https://en.wikipedia.org/wiki/Proxy_server How To Use Proxy Server To Access Internet at Shell Prompt With http_proxy Variable - nixCraft, https://www.cyberciti.biz/faq/linux-unix-set-proxy-environment-variable/ Control Docker with systemd | Docker Documentation, https://docs.docker.com/config/daemon/systemd/#httphttps-proxy Using Minikube with an HTTP Proxy, https://kubernetes.io/docs/setup/minikube/#using-minikube-with-an-http-proxy bash - Set a network range in the no_proxy environment variable - Unix &amp; Linux Stack Exchange, https://unix.stackexchange.com/questions/23452/set-a-network-range-in-the-no-proxy-environment-variable" />
<link rel="canonical" href="https://blog.codefarm.me/2018/08/09/http-proxy-docker-minikube/" />
<meta property="og:url" content="https://blog.codefarm.me/2018/08/09/http-proxy-docker-minikube/" />
<meta property="og:site_name" content="CODE FARM" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-09T17:15:35+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Docker and Minikube behind HTTP Proxy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-08-09T17:15:35+08:00","datePublished":"2018-08-09T17:15:35+08:00","description":"1. Setup HTTP Proxy Environment Variables 2. Custom Docker Daemon Options with HTTP Proxy 3. Start minikube behind a HTTP Proxy References 1. Setup HTTP Proxy Environment Variables Linux and Unix-like systems has environment variable called http_proxy, https_proxy and no_proxy. It allows you to connect text based session and/or applications via the proxy server. All you need is proxy server IP address (URL) and port values. The variable is almost used by all utilities such as elinks, lynx, wget, curl, git and others commands. Type the following command to set proxy server environment variables: $ export http_proxy=http://[USERNAME:PASSWORD@]server-ip:port/ $ export https_proxy=http://[USERNAME:PASSWORD@]server-ip:port/ $ export no_proxy=localhost,127.0.0.1,::1,codefarm.me To setup the proxy environment variable as a global variable for all users, append the above settings into /etc/profile file or /etc/profile.d/http-proxy.sh. for example: $ cat /etc/profile.d/http_proxy.sh export {HTTP,HTTPS}_PROXY=http://10.38.32.9:10808/ export {http,https}_proxy=http://10.38.32.9:10808/ export {NO_PROXY,no_proxy}=localhost,127.0.0.1,::1,192.168.99.100 $ env | grep -i proxy HTTP_PROXY=http://10.38.32.9:10808/ https_proxy=http://10.38.32.9:10808/ http_proxy=http://10.38.32.189:10808/ no_proxy=localhost,127.0.0.1,::1,192.168.99.100 NO_PROXY=localhost,127.0.0.1,::1,192.168.99.100 HTTPS_PROXY=http://10.38.32.9:10808/ 2. Custom Docker Daemon Options with HTTP Proxy The Docker daemon uses the HTTP_PROXY, HTTPS_PROXY, and NO_PROXY environmental variables in its start-up environment to configure HTTP or HTTPS proxy behavior. You cannot configure these environment variables using the daemon.json file. This example overrides the default docker.service file. If you are behind an HTTP or HTTPS proxy server, for example in corporate settings, you need to add this configuration in the Docker systemd service file. Create a systemd drop-in directory for the docker service: $ sudo mkdir -p /etc/systemd/system/docker.service.d Create a file called /etc/systemd/system/docker.service.d/http-proxy.conf that adds the HTTP_PROXY environment variable: [Service] Environment=&quot;HTTP_PROXY=http://proxy.example.com:80/&quot; Or, if you are behind an HTTPS proxy server, create a file called /etc/systemd/system/docker.service.d/https-proxy.conf that adds the HTTPS_PROXY environment variable: [Service] Environment=&quot;HTTPS_PROXY=https://proxy.example.com:443/&quot; If you have internal Docker registries that you need to contact without proxying you can specify them via the NO_PROXY environment variable: [Service] Environment=&quot;HTTP_PROXY=http://proxy.example.com:80/&quot; &quot;NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com&quot; Or, if you are behind an HTTPS proxy server: [Service] Environment=&quot;HTTPS_PROXY=https://proxy.example.com:443/&quot; &quot;NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com&quot; Flush changes: $ sudo systemctl daemon-reload Restart Docker: $ sudo systemctl restart docker Verify that the configuration has been loaded: $ systemctl show --property=Environment docker Environment=HTTP_PROXY=http://proxy.example.com:80/ Or, if you are behind an HTTPS proxy server: $ systemctl show --property=Environment docker Environment=HTTPS_PROXY=https://proxy.example.com:443/ 3. Start minikube behind a HTTP Proxy Print the version of minikube. $ minikube version minikube version: v0.25.2 The latest minikube version is 0.28.2 at this time, but it doesn’t work well cause it hangs up at Starting cluster components…. Use --docker-env flag to pass environment variables to the Docker daemon. minikube start \\ --docker-env HTTP_PROXY=http://10.38.32.9:10808/ \\ --docker-env HTTPS_PROXY=http://10.38.32.9:10808/ \\ --docker-env NO_PROXY=index.docker.io,\\ registry.hub.docker.com,\\ registry-1.docker.io,\\ registry.docker-cn.com,\\ registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,\\ 192.168.99.100\\ --registry-mirror https://registry.docker-cn.com Not required: Pass the --registry-mirror option when starting dockerd to pull-through China mirror cache. Use kubectl version to print the client and server version information. $ kubectl version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.0&quot;, GitCommit:&quot;91e7b4fd31fcd3d5f436da26c980becec37ceefe&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-06-27T20:17:28Z&quot;, GoVersion:&quot;go1.10.2&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} Server Version: version.Info{Major:&quot;&quot;, Minor:&quot;&quot;, GitVersion:&quot;v1.9.4&quot;, GitCommit:&quot;bee2d1505c4fe820744d26d41ecd3fdd4a3d6546&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-03-21T21:48:36Z&quot;, GoVersion:&quot;go1.9.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} After starting the minikube, the --docker-env and --registry-mirror options were wrote into config.json file at $HOME/.minikube/machines/minikube/config.json. And when starting minikube with minikube start, it will reload the config from the file config.json again. 33 &quot;HostOptions&quot;: { 37 &quot;EngineOptions&quot;: { . 41 &quot;Env&quot;: [ 42 &quot;HTTP_PROXY=http://10.38.32.9:10808/&quot;, 43 &quot;HTTPS_PROXY=http://10.38.32.9:10808/&quot;, 44 &quot;NO_PROXY=index.docker.io,registry.hub.docker.com,registry-1.docker.io,registry.docker-cn.com,registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,192.168.99.100&quot; 45 ], . 55 &quot;RegistryMirror&quot;: [ 56 &quot;https://registry.docker-cn.com&quot; 57 ], The minikube start --docker-env doesn’t work on my Windows 10 laptop. But you can edit the config.json directly, then start the minikube and execute the following command to reload docker daemon. $ uname.exe -a MINGW64_NT-10.0 minikube 2.10.0(0.325/5/3) 2018-06-13 23:34 x86_64 Msys $ minikube.exe start There is a newer version of minikube available (v0.28.2). Download it here: https://github.com/kubernetes/minikube/releases/tag/v0.28.2 To disable this notification, run the following: minikube config set WantUpdateNotification false Starting local Kubernetes v1.9.4 cluster... Starting VM... Getting VM IP address... Moving files into cluster... Setting up certs... Connecting to cluster... Setting up kubeconfig... Starting cluster components... Kubectl is now configured to use the cluster. Loading cached images from config file. Unable to load cached images from config file. $ kubectl.exe version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;7&quot;, GitVersion:&quot;v1.7.4&quot;, GitCommit:&quot;793658f2d7ca7f064d2bdf606519f9fe1229c381&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2017-08-17T08:48:23Z&quot;, GoVersion:&quot;go1.8.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;windows/amd64&quot;} Server Version: version.Info{Major:&quot;&quot;, Minor:&quot;&quot;, GitVersion:&quot;v1.9.4&quot;, GitCommit:&quot;bee2d1505c4fe820744d26d41ecd3fdd4a3d6546&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-03-21T21:48:36Z&quot;, GoVersion:&quot;go1.9.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} $ minikube.exe ssh _ _ _ _ ( ) ( ) ___ ___ (_) ___ (_)| |/&#39;) _ _ | |_ __ /&#39; _ ` _ `\\| |/&#39; _ `\\| || , &lt; ( ) ( )| &#39;_`\\ /&#39;__`\\ | ( ) ( ) || || ( ) || || |\\`\\ | (_) || |_) )( ___/ (_) (_) (_)(_)(_) (_)(_)(_) (_)`\\___/&#39;(_,__/&#39;`\\____) $ sudo systemctl daemon-reload $ sudo systemctl restart docker Hello Minikube $ kubectl run nginx --image=nginx --image-pull-policy=IfNotPresent --replicas=2 deployment.apps/nginx created $ kubectl get pods NAME READY STATUS RESTARTS AGE nginx-6d78847c9c-298qt 1/1 Running 0 &lt;invalid&gt; nginx-6d78847c9c-v88mt 1/1 Running 0 &lt;invalid&gt; $ kubectl expose deployments/nginx --type=NodePort --port 80 service/nginx exposed $ export NODE_PORT=$(kubectl get service nginx -o go-template=&#39;{{(index .spec.ports 0).nodePort}}&#39;) $ echo $NODE_PORT 32659 $ curl -i -XOPTION $(minikube ip):$NODE_PORT HTTP/1.1 405 Not Allowed Server: nginx/1.15.2 Date: Fri, 10 Aug 2018 09:36:08 GMT Content-Type: text/html Content-Length: 173 Connection: keep-alive &lt;html&gt; &lt;head&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt; &lt;body bgcolor=&quot;white&quot;&gt; &lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt; &lt;hr&gt;&lt;center&gt;nginx/1.15.2&lt;/center&gt; &lt;/body&gt; &lt;/html&gt; References Proxy server - Wikipedia, https://en.wikipedia.org/wiki/Proxy_server How To Use Proxy Server To Access Internet at Shell Prompt With http_proxy Variable - nixCraft, https://www.cyberciti.biz/faq/linux-unix-set-proxy-environment-variable/ Control Docker with systemd | Docker Documentation, https://docs.docker.com/config/daemon/systemd/#httphttps-proxy Using Minikube with an HTTP Proxy, https://kubernetes.io/docs/setup/minikube/#using-minikube-with-an-http-proxy bash - Set a network range in the no_proxy environment variable - Unix &amp; Linux Stack Exchange, https://unix.stackexchange.com/questions/23452/set-a-network-range-in-the-no-proxy-environment-variable","headline":"Docker and Minikube behind HTTP Proxy","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.codefarm.me/2018/08/09/http-proxy-docker-minikube/"},"url":"https://blog.codefarm.me/2018/08/09/http-proxy-docker-minikube/"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/assets/css/style.css"><!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-SN88FJ18E5');
    </script></head>
  <body>
    <header class="c-header">
  <div class="o-container">
    <a class="c-header-title" href="/">CODE FARM</a>
    <button class="c-header-nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
      <span class="c-header-nav-toggle-icon"></span>
    </button>
    <div class="c-header-nav-wrapper" id="nav-wrapper">
      <nav class="c-header-nav">
        <a href="/">Home</a>
        <a href="/categories/">Category</a>
        <a href="/tags/">Tag</a>
        <a href="/archives/">Archive</a>
        <a href="/about/">About</a>
        <a href="https://resume.github.io/?looogos" target="_blank">R&eacute;sum&eacute;</a>
      </nav>
    </div>
  </div>
  



<div class="o-container">
  <div class="c-banner">
    <img src="/assets/images/galaxy.svg" alt="Galaxy background" class="c-banner-bg">
    <div class="c-banner-quote">
      <p>"The Renaissance was a time when art, science, and philosophy flourished."</p>
      <cite>- Michelangelo</cite>
    </div>
  </div>
</div>
</header>

    <main class="o-container">
      <article class="c-post">
  <header class="c-post-header">
    <h1 class="c-post-title">Docker and Minikube behind HTTP Proxy</h1><p class="c-post-meta">09 Aug 2018</p>
  </header>

  <div class="c-post-content">
    <ul id="markdown-toc">
  <li><a href="#1-setup-http-proxy-environment-variables" id="markdown-toc-1-setup-http-proxy-environment-variables">1. Setup HTTP Proxy Environment Variables</a></li>
  <li><a href="#2-custom-docker-daemon-options-with-http-proxy" id="markdown-toc-2-custom-docker-daemon-options-with-http-proxy">2. Custom Docker Daemon Options with HTTP Proxy</a></li>
  <li><a href="#3-start-minikube-behind-a-http-proxy" id="markdown-toc-3-start-minikube-behind-a-http-proxy">3. Start minikube behind a HTTP Proxy</a></li>
  <li><a href="#references" id="markdown-toc-references">References</a></li>
</ul>

<hr />

<h3 id="1-setup-http-proxy-environment-variables">1. Setup HTTP Proxy Environment Variables</h3>

<p>Linux and Unix-like systems has environment variable called <code class="language-plaintext highlighter-rouge">http_proxy</code>, <code class="language-plaintext highlighter-rouge">https_proxy</code> and <code class="language-plaintext highlighter-rouge">no_proxy</code>. It allows you to connect text based session and/or applications via the proxy server. All you need is proxy server IP address (URL) and port values. The variable is almost used by all utilities such as elinks, lynx, wget, curl, git and others commands.</p>

<p>Type the following command to set proxy server environment variables:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://[USERNAME:PASSWORD@]server-ip:port/
<span class="nv">$ </span><span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://[USERNAME:PASSWORD@]server-ip:port/
<span class="nv">$ </span><span class="nb">export </span><span class="nv">no_proxy</span><span class="o">=</span>localhost,127.0.0.1,::1,codefarm.me
</code></pre></div></div>

<p>To setup the proxy environment variable as a global variable for all users, append the above settings into <em>/etc/profile</em> file or <em>/etc/profile.d/http-proxy.sh</em>. for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> /etc/profile.d/http_proxy.sh
<span class="nb">export</span> <span class="o">{</span>HTTP,HTTPS<span class="o">}</span><span class="nv">_PROXY</span><span class="o">=</span>http://10.38.32.9:10808/
<span class="nb">export</span> <span class="o">{</span>http,https<span class="o">}</span><span class="nv">_proxy</span><span class="o">=</span>http://10.38.32.9:10808/
<span class="nb">export</span> <span class="o">{</span>NO_PROXY,no_proxy<span class="o">}=</span>localhost,127.0.0.1,::1,192.168.99.100
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">env</span> | <span class="nb">grep</span> <span class="nt">-i</span> proxy
<span class="nv">HTTP_PROXY</span><span class="o">=</span>http://10.38.32.9:10808/
<span class="nv">https_proxy</span><span class="o">=</span>http://10.38.32.9:10808/
<span class="nv">http_proxy</span><span class="o">=</span>http://10.38.32.189:10808/
<span class="nv">no_proxy</span><span class="o">=</span>localhost,127.0.0.1,::1,192.168.99.100
<span class="nv">NO_PROXY</span><span class="o">=</span>localhost,127.0.0.1,::1,192.168.99.100
<span class="nv">HTTPS_PROXY</span><span class="o">=</span>http://10.38.32.9:10808/
</code></pre></div></div>

<h3 id="2-custom-docker-daemon-options-with-http-proxy">2. Custom Docker Daemon Options with HTTP Proxy</h3>

<p>The Docker daemon uses the <code class="language-plaintext highlighter-rouge">HTTP_PROXY</code>, <code class="language-plaintext highlighter-rouge">HTTPS_PROXY</code>, and <code class="language-plaintext highlighter-rouge">NO_PROXY</code> environmental variables in its start-up environment to configure HTTP or HTTPS proxy behavior. You cannot configure these environment variables using the <code class="language-plaintext highlighter-rouge">daemon.json</code> file.</p>

<p>This example overrides the default <code class="language-plaintext highlighter-rouge">docker.service</code> file.</p>

<p>If you are behind an HTTP or HTTPS proxy server, for example in corporate settings, you need to add this configuration in the Docker systemd service file.</p>

<ol>
  <li>
    <p>Create a systemd drop-in directory for the docker service:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/systemd/system/docker.service.d
</code></pre></div>    </div>
  </li>
  <li>
    <p>Create a file called <code class="language-plaintext highlighter-rouge">/etc/systemd/system/docker.service.d/http-proxy.conf</code>
that adds the <code class="language-plaintext highlighter-rouge">HTTP_PROXY</code> environment variable:</p>

    <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[<span class="n">Service</span>]
<span class="n">Environment</span>=<span class="s2">"HTTP_PROXY=http://proxy.example.com:80/"</span>
</code></pre></div>    </div>

    <p>Or, if you are behind an HTTPS proxy server, create a file called
<code class="language-plaintext highlighter-rouge">/etc/systemd/system/docker.service.d/https-proxy.conf</code>
that adds the <code class="language-plaintext highlighter-rouge">HTTPS_PROXY</code> environment variable:</p>

    <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[<span class="n">Service</span>]
<span class="n">Environment</span>=<span class="s2">"HTTPS_PROXY=https://proxy.example.com:443/"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you have internal Docker registries that you need to contact without
proxying you can specify them via the <code class="language-plaintext highlighter-rouge">NO_PROXY</code> environment variable:</p>

    <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[<span class="n">Service</span>]    
<span class="n">Environment</span>=<span class="s2">"HTTP_PROXY=http://proxy.example.com:80/"</span> <span class="s2">"NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com"</span>
</code></pre></div>    </div>

    <p>Or, if you are behind an HTTPS proxy server:</p>

    <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[<span class="n">Service</span>]    
<span class="n">Environment</span>=<span class="s2">"HTTPS_PROXY=https://proxy.example.com:443/"</span> <span class="s2">"NO_PROXY=localhost,127.0.0.1,docker-registry.somecorporation.com"</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Flush changes:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
</code></pre></div>    </div>
  </li>
  <li>
    <p>Restart Docker:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>systemctl restart docker
</code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that the configuration has been loaded:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl show <span class="nt">--property</span><span class="o">=</span>Environment docker
<span class="nv">Environment</span><span class="o">=</span><span class="nv">HTTP_PROXY</span><span class="o">=</span>http://proxy.example.com:80/
</code></pre></div>    </div>

    <p>Or, if you are behind an HTTPS proxy server:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>systemctl show <span class="nt">--property</span><span class="o">=</span>Environment docker
<span class="nv">Environment</span><span class="o">=</span><span class="nv">HTTPS_PROXY</span><span class="o">=</span>https://proxy.example.com:443/
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="3-start-minikube-behind-a-http-proxy">3. Start minikube behind a HTTP Proxy</h3>

<ol>
  <li>
    <p>Print the version of minikube.</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>minikube version
 minikube version: v0.25.2
</code></pre></div>    </div>

    <blockquote>
      <p>The latest minikube version is 0.28.2 at this time, but it doesn’t work well cause it hangs up at <em>Starting cluster components…</em>.</p>
    </blockquote>
  </li>
  <li>
    <p>Use <code class="language-plaintext highlighter-rouge">--docker-env</code> flag to pass environment variables to the Docker daemon.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> minikube start <span class="se">\</span>
     <span class="nt">--docker-env</span> <span class="nv">HTTP_PROXY</span><span class="o">=</span>http://10.38.32.9:10808/ <span class="se">\</span>
     <span class="nt">--docker-env</span> <span class="nv">HTTPS_PROXY</span><span class="o">=</span>http://10.38.32.9:10808/ <span class="se">\</span>
     <span class="nt">--docker-env</span> <span class="nv">NO_PROXY</span><span class="o">=</span>index.docker.io,<span class="se">\</span>
 registry.hub.docker.com,<span class="se">\</span>
 registry-1.docker.io,<span class="se">\</span>
 registry.docker-cn.com,<span class="se">\</span>
 registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,<span class="se">\</span>
 192.168.99.100<span class="se">\</span>
     <span class="nt">--registry-mirror</span> https://registry.docker-cn.com
</code></pre></div>    </div>

    <blockquote>
      <p>Not required: Pass the <code class="language-plaintext highlighter-rouge">--registry-mirror</code> option when starting <code class="language-plaintext highlighter-rouge">dockerd</code> to pull-through China mirror cache.</p>
    </blockquote>

    <p>Use <code class="language-plaintext highlighter-rouge">kubectl version</code> to print the client and server version information.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>kubectl version
 Client Version: version.Info<span class="o">{</span>Major:<span class="s2">"1"</span>, Minor:<span class="s2">"11"</span>, GitVersion:<span class="s2">"v1.11.0"</span>, GitCommit:<span class="s2">"91e7b4fd31fcd3d5f436da26c980becec37ceefe"</span>, GitTreeState:<span class="s2">"clean"</span>, BuildDate:<span class="s2">"2018-06-27T20:17:28Z"</span>, GoVersion:<span class="s2">"go1.10.2"</span>, Compiler:<span class="s2">"gc"</span>, Platform:<span class="s2">"linux/amd64"</span><span class="o">}</span>
 Server Version: version.Info<span class="o">{</span>Major:<span class="s2">""</span>, Minor:<span class="s2">""</span>, GitVersion:<span class="s2">"v1.9.4"</span>, GitCommit:<span class="s2">"bee2d1505c4fe820744d26d41ecd3fdd4a3d6546"</span>, GitTreeState:<span class="s2">"clean"</span>, BuildDate:<span class="s2">"2018-03-21T21:48:36Z"</span>, GoVersion:<span class="s2">"go1.9.1"</span>, Compiler:<span class="s2">"gc"</span>, Platform:<span class="s2">"linux/amd64"</span><span class="o">}</span>
</code></pre></div>    </div>

    <p>After starting the minikube, the <code class="language-plaintext highlighter-rouge">--docker-env</code> and <code class="language-plaintext highlighter-rouge">--registry-mirror</code> options were wrote into <code class="language-plaintext highlighter-rouge">config.json</code> file at <em>$HOME/.minikube/machines/minikube/config.json</em>. And when starting minikube with <code class="language-plaintext highlighter-rouge">minikube start</code>, it will reload the config from the file <code class="language-plaintext highlighter-rouge">config.json</code> again.</p>

    <pre><code class="language-none">     33      "HostOptions": {
     37          "EngineOptions": {
     .
     41              "Env": [
     42                  "HTTP_PROXY=http://10.38.32.9:10808/",
     43                  "HTTPS_PROXY=http://10.38.32.9:10808/",
     44                  "NO_PROXY=index.docker.io,registry.hub.docker.com,registry-1.docker.io,registry.docker-cn.com,registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,192.168.99.100"
     45              ],
     .
     55              "RegistryMirror": [
     56                  "https://registry.docker-cn.com"
     57              ],
</code></pre>

    <blockquote>
      <p>The <code class="language-plaintext highlighter-rouge">minikube start --docker-env</code> doesn’t work on my Windows 10 laptop. But you can edit the <code class="language-plaintext highlighter-rouge">config.json</code> directly, then start the minikube and execute the following command to reload docker daemon.</p>
    </blockquote>

    <blockquote>
      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>uname.exe  <span class="nt">-a</span>
MINGW64_NT-10.0 minikube 2.10.0<span class="o">(</span>0.325/5/3<span class="o">)</span> 2018-06-13 23:34 x86_64 Msys
<span class="nv">$ </span>minikube.exe  start
There is a newer version of minikube available <span class="o">(</span>v0.28.2<span class="o">)</span><span class="nb">.</span>  Download it here:
https://github.com/kubernetes/minikube/releases/tag/v0.28.2

To disable this notification, run the following:
minikube config <span class="nb">set </span>WantUpdateNotification <span class="nb">false
</span>Starting <span class="nb">local </span>Kubernetes v1.9.4 cluster...
Starting VM...
Getting VM IP address...
Moving files into cluster...
Setting up certs...
Connecting to cluster...
Setting up kubeconfig...
Starting cluster components...
Kubectl is now configured to use the cluster.
Loading cached images from config file.
Unable to load cached images from config file.
<span class="nv">$ </span>kubectl.exe version
Client Version: version.Info<span class="o">{</span>Major:<span class="s2">"1"</span>, Minor:<span class="s2">"7"</span>, GitVersion:<span class="s2">"v1.7.4"</span>, GitCommit:<span class="s2">"793658f2d7ca7f064d2bdf606519f9fe1229c381"</span>, GitTreeState:<span class="s2">"clean"</span>, BuildDate:<span class="s2">"2017-08-17T08:48:23Z"</span>, GoVersion:<span class="s2">"go1.8.3"</span>, Compiler:<span class="s2">"gc"</span>, Platform:<span class="s2">"windows/amd64"</span><span class="o">}</span>
Server Version: version.Info<span class="o">{</span>Major:<span class="s2">""</span>, Minor:<span class="s2">""</span>, GitVersion:<span class="s2">"v1.9.4"</span>, GitCommit:<span class="s2">"bee2d1505c4fe820744d26d41ecd3fdd4a3d6546"</span>, GitTreeState:<span class="s2">"clean"</span>, BuildDate:<span class="s2">"2018-03-21T21:48:36Z"</span>, GoVersion:<span class="s2">"go1.9.1"</span>, Compiler:<span class="s2">"gc"</span>, Platform:<span class="s2">"linux/amd64"</span><span class="o">}</span>
<span class="nv">$ </span>minikube.exe ssh
                         _             _
            _         _ <span class="o">(</span> <span class="o">)</span>           <span class="o">(</span> <span class="o">)</span>
  ___ ___  <span class="o">(</span>_<span class="o">)</span>  ___  <span class="o">(</span>_<span class="o">)</span>| |/<span class="s1">')  _   _ | |_      __
/'</span> _ <span class="sb">`</span> _ <span class="sb">`</span><span class="se">\|</span> |/<span class="s1">' _ `\| || , &lt;  ( ) ( )| '</span>_<span class="sb">`</span><span class="se">\ </span> /<span class="s1">'__`\
| ( ) ( ) || || ( ) || || |\`\ | (_) || |_) )(  ___/
(_) (_) (_)(_)(_) (_)(_)(_) (_)`\___/'</span><span class="o">(</span>_,__/<span class="s1">'`\____)

$ sudo systemctl daemon-reload
$ sudo systemctl restart docker
</span></code></pre></div>      </div>
    </blockquote>
  </li>
  <li>
    <p>Hello Minikube</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>kubectl run nginx <span class="nt">--image</span><span class="o">=</span>nginx <span class="nt">--image-pull-policy</span><span class="o">=</span>IfNotPresent <span class="nt">--replicas</span><span class="o">=</span>2
 deployment.apps/nginx created
 <span class="nv">$ </span>kubectl get pods
 NAME                     READY     STATUS    RESTARTS   AGE
 nginx-6d78847c9c-298qt   1/1       Running   0          &lt;invalid&gt;
 nginx-6d78847c9c-v88mt   1/1       Running   0          &lt;invalid&gt;
 <span class="nv">$ </span>kubectl expose deployments/nginx <span class="nt">--type</span><span class="o">=</span>NodePort <span class="nt">--port</span> 80
 service/nginx exposed
 <span class="nv">$ </span><span class="nb">export </span><span class="nv">NODE_PORT</span><span class="o">=</span><span class="si">$(</span>kubectl get service nginx <span class="nt">-o</span> go-template<span class="o">=</span><span class="s1">'{{(index .spec.ports 0).nodePort}}'</span><span class="si">)</span>
 <span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$NODE_PORT</span>
 32659
 <span class="nv">$ </span>curl <span class="nt">-i</span> <span class="nt">-XOPTION</span> <span class="si">$(</span>minikube ip<span class="si">)</span>:<span class="nv">$NODE_PORT</span>
 HTTP/1.1 405 Not Allowed
 Server: nginx/1.15.2
 Date: Fri, 10 Aug 2018 09:36:08 GMT
 Content-Type: text/html
 Content-Length: 173
 Connection: keep-alive
    
 &lt;html&gt;
 &lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt;
 &lt;body <span class="nv">bgcolor</span><span class="o">=</span><span class="s2">"white"</span><span class="o">&gt;</span>
 &lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt;
 &lt;hr&gt;&lt;center&gt;nginx/1.15.2&lt;/center&gt;
 &lt;/body&gt;
 &lt;/html&gt;
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="references">References</h3>

<ol>
  <li>Proxy server - Wikipedia, <a href="https://en.wikipedia.org/wiki/Proxy_server">https://en.wikipedia.org/wiki/Proxy_server</a></li>
  <li>How To Use Proxy Server To Access Internet at Shell Prompt With http_proxy Variable - nixCraft, <a href="https://www.cyberciti.biz/faq/linux-unix-set-proxy-environment-variable/">https://www.cyberciti.biz/faq/linux-unix-set-proxy-environment-variable/</a></li>
  <li>Control Docker with systemd | Docker Documentation, <a href="https://docs.docker.com/config/daemon/systemd/#httphttps-proxy">https://docs.docker.com/config/daemon/systemd/#httphttps-proxy</a></li>
  <li>Using Minikube with an HTTP Proxy, <a href="https://kubernetes.io/docs/setup/minikube/#using-minikube-with-an-http-proxy">https://kubernetes.io/docs/setup/minikube/#using-minikube-with-an-http-proxy</a></li>
  <li>bash - Set a network range in the no_proxy environment variable - Unix &amp; Linux Stack Exchange, <a href="https://unix.stackexchange.com/questions/23452/set-a-network-range-in-the-no-proxy-environment-variable">https://unix.stackexchange.com/questions/23452/set-a-network-range-in-the-no-proxy-environment-variable</a></li>
</ol>

<style>
  .utterances {
      max-width: 100%;
  }
</style>
<script src="https://utteranc.es/client.js"
        repo="looogos/utterances"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

</div>
</article>
    </main>
    <footer class="c-footer">
  <div class="c-footer-license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details class="c-footer-extralinks" open>
    <summary class="c-footer-extralinks-summary">Extral Links</summary>
    <div class="c-footer-extralinks-content">
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/liquid/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>

    <script src="/assets/js/nav.js" defer></script>
    <script src="/assets/js/heading-anchors.js" defer></script>
    <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->    
    <script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>
  </body>
</html>
